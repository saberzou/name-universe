<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Postcards from Mars</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Space+Mono:wght@400;700&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --rust: #C1440E;
  --dust: #E8763A;
  --sand: #D4A574;
  --charcoal: #1A1A1A;
  --gray: #8B8B8B;
  --cream: #F5EDE3;
}

html, body {
  height: 100%;
  overflow: hidden;
  font-family: 'DM Sans', sans-serif;
  background: var(--charcoal);
  color: var(--cream);
  -webkit-font-smoothing: antialiased;
}

/* --- Canvas fills viewport --- */
#scene {
  position: fixed;
  inset: 0;
  z-index: 0;
}

/* --- UI overlay --- */
.overlay {
  position: fixed;
  inset: 0;
  z-index: 10;
  pointer-events: none;
  display: flex;
  flex-direction: column;
}

.header {
  padding: 2rem 2.5rem;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.logo {
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.75rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--sand);
  opacity: 0.7;
}

.signal {
  font-family: 'Space Mono', monospace;
  font-size: 0.65rem;
  color: var(--gray);
  text-align: right;
  line-height: 1.6;
  opacity: 0.5;
}

.footer {
  margin-top: auto;
  padding: 2rem 2.5rem;
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
}

.hint {
  font-family: 'Space Mono', monospace;
  font-size: 0.65rem;
  color: var(--gray);
  opacity: 0.4;
  transition: opacity 0.3s;
}

.nav {
  display: flex;
  gap: 0.75rem;
  pointer-events: auto;
}

.nav button {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  color: var(--cream);
  font-family: 'Space Mono', monospace;
  font-size: 0.7rem;
  padding: 0.5rem 1rem;
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 0.05em;
}

.nav button:hover {
  background: rgba(255,255,255,0.12);
  border-color: rgba(255,255,255,0.2);
}

.robot-id {
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.7rem;
  letter-spacing: 0.1em;
  color: var(--dust);
  opacity: 0.6;
}

/* --- Card text overlays (rendered on canvas textures instead) --- */

/* --- Mobile --- */
@media (max-width: 640px) {
  .header, .footer { padding: 1.25rem; }
  .logo { font-size: 0.65rem; }
}

/* --- Dust particles (CSS) --- */
.dust {
  position: fixed;
  width: 2px;
  height: 2px;
  background: var(--sand);
  border-radius: 50%;
  opacity: 0;
  pointer-events: none;
  z-index: 1;
  animation: drift linear infinite;
}

@keyframes drift {
  0% { transform: translate(0, 0); opacity: 0; }
  10% { opacity: 0.3; }
  90% { opacity: 0.15; }
  100% { transform: translate(var(--dx), var(--dy)); opacity: 0; }
}
</style>
</head>
<body>

<canvas id="scene"></canvas>

<div class="overlay">
  <div class="header">
    <div class="logo">Postcards from Mars</div>
    <div class="signal" id="signal">
      SIGNAL: ████░░ 67%<br>
      RELAY-1 → EARTH<br>
      DELAY: 12m 34s
    </div>
  </div>
  <div class="footer">
    <div>
      <div class="robot-id" id="robotId">SCOUT-9</div>
      <div class="hint" id="hint">click to flip · drag to tilt</div>
    </div>
    <div class="nav">
      <button id="prevBtn">← PREV</button>
      <button id="nextBtn">NEXT →</button>
    </div>
  </div>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.171.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.171.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';

// ─── Postcard data ───
const postcards = [
  {
    id: 'scout-9',
    name: 'SCOUT-9',
    sol: 612,
    coords: '4.5°S, 137.4°E',
    signal: 67,
    front: {
      type: 'landscape',
      title: 'HEART-SHAPED ROCK',
      subtitle: 'Jezero Crater, Sol 612',
      color: '#E8763A',
    },
    back: {
      message: 'Sol 612: LOOK AT THIS!\nFound a rock shaped like a heart!\nKeeping it in my collection.\nMars isn\'t so lonely after all ♥\nMiss you, Earth!',
    }
  },
  {
    id: 'surveyor-2',
    name: 'SURVEYOR-2',
    sol: 2847,
    coords: '18.4°N, 226.0°E',
    signal: 52,
    front: {
      type: 'data',
      title: 'DUST STORM #487',
      subtitle: 'Olympus Mons Region, Sol 2847',
      color: '#C1440E',
    },
    back: {
      message: 'Sol 2847. Dust storm #487.\nSolar panels at 34%. Still operational.\nSame view, different storm.\nStill here.',
    }
  },
  {
    id: 'explorer-7',
    name: 'EXPLORER-7',
    sol: 1104,
    coords: '14.6°S, 175.5°E',
    signal: 71,
    front: {
      type: 'landscape',
      title: 'TWO MOONS RISING',
      subtitle: 'Hellas Basin, Sol 1104',
      color: '#D4A574',
    },
    back: {
      message: 'Sol 1104.\nPhobos rises twice tonight.\nTwo moons, two shadows.\nI wonder if Earth remembers us—\nthe small machines it sent away,\nstill looking up at the sky.',
    }
  },
  {
    id: 'mapper-4',
    name: 'MAPPER-4',
    sol: 923,
    coords: '1.0°N, 247.0°E',
    signal: 88,
    front: {
      type: 'data',
      title: 'OLYMPUS MONS SCAN',
      subtitle: 'Tharsis Region, Sol 923',
      color: '#E8763A',
    },
    back: {
      message: 'Sol 923. Olympus Mons: 21.9km tall.\nThat\'s 2.5x Mount Everest.\nTook 2,847 photos today.\nProcessed 18,394 data points.\nHere\'s the best one.',
    }
  },
  {
    id: 'relay-1',
    name: 'RELAY-1',
    sol: 1523,
    coords: '0.0°, 0.0°E',
    signal: 44,
    front: {
      type: 'data',
      title: 'SIGNAL TRANSMISSION',
      subtitle: 'Mars Relay Network, Sol 1523',
      color: '#8B8B8B',
    },
    back: {
      message: '[Status: X_X]\nSol 1523. Transmitted 847 messages today.\nEveryone else\'s words, traveling home.\nI\'m the voice that carries voices.\nSometimes I wonder if anyone\nhears mine.',
    }
  },
];

let currentIndex = 0;
let isFlipped = false;
let targetRotX = 0, targetRotY = 0;
let currentRotX = 0, currentRotY = 0;
let flipAngle = 0, targetFlip = 0;

// ─── Scene setup ───
const canvas = document.getElementById('scene');
const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.2;

const scene = new THREE.Scene();

// Mars sky gradient background
const bgCanvas = document.createElement('canvas');
bgCanvas.width = 2;
bgCanvas.height = 512;
const bgCtx = bgCanvas.getContext('2d');
const grad = bgCtx.createLinearGradient(0, 0, 0, 512);
grad.addColorStop(0, '#1A1210');
grad.addColorStop(0.3, '#2A1A12');
grad.addColorStop(0.6, '#3D2218');
grad.addColorStop(0.85, '#5C3420');
grad.addColorStop(1, '#1A1210');
bgCtx.fillStyle = grad;
bgCtx.fillRect(0, 0, 2, 512);
const bgTex = new THREE.CanvasTexture(bgCanvas);
scene.background = bgTex;

const camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 100);
camera.position.set(0, 0, 4);

// Lights
const ambientLight = new THREE.AmbientLight(0xD4A574, 0.3);
scene.add(ambientLight);

const keyLight = new THREE.DirectionalLight(0xFFF0E0, 1.5);
keyLight.position.set(3, 4, 5);
scene.add(keyLight);

const fillLight = new THREE.DirectionalLight(0xE8763A, 0.4);
fillLight.position.set(-3, -1, 3);
scene.add(fillLight);

const rimLight = new THREE.DirectionalLight(0xC1440E, 0.6);
rimLight.position.set(0, -2, -3);
scene.add(rimLight);

// ─── Card geometry ───
const CARD_W = 1.6;
const CARD_H = 2.2;
const cardGroup = new THREE.Group();
scene.add(cardGroup);

// Generate front texture
function createFrontTexture(postcard) {
  const c = document.createElement('canvas');
  c.width = 800;
  c.height = 1100;
  const ctx = c.getContext('2d');

  // Background
  const g = ctx.createLinearGradient(0, 0, 800, 1100);
  g.addColorStop(0, '#2A1A12');
  g.addColorStop(0.5, '#3D2218');
  g.addColorStop(1, '#1A1210');
  ctx.fillStyle = g;
  ctx.fillRect(0, 0, 800, 1100);

  // Geometric decorative elements
  ctx.strokeStyle = postcard.front.color + '40';
  ctx.lineWidth = 1;

  // Grid lines
  for (let i = 0; i < 20; i++) {
    const y = 80 + i * 50;
    ctx.beginPath();
    ctx.moveTo(60, y);
    ctx.lineTo(740, y);
    ctx.stroke();
  }

  // Topographic circles
  ctx.strokeStyle = postcard.front.color + '30';
  ctx.lineWidth = 0.8;
  for (let r = 50; r < 350; r += 30) {
    ctx.beginPath();
    ctx.ellipse(500, 500, r, r * 0.7, -0.2, 0, Math.PI * 2);
    ctx.stroke();
  }

  // Scan lines
  ctx.strokeStyle = postcard.front.color + '20';
  for (let i = 0; i < 800; i += 3) {
    ctx.beginPath();
    ctx.moveTo(i, 0);
    ctx.lineTo(i, 1100);
    ctx.stroke();
  }

  // Title area
  ctx.fillStyle = postcard.front.color;
  ctx.font = 'bold 48px "Archivo Black", sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText(postcard.front.title, 60, 900);

  ctx.fillStyle = '#D4A574';
  ctx.font = '18px "Space Mono", monospace';
  ctx.fillText(postcard.front.subtitle, 60, 940);

  // Border
  ctx.strokeStyle = postcard.front.color + '60';
  ctx.lineWidth = 2;
  ctx.strokeRect(30, 30, 740, 1040);

  // Corner markers
  const corners = [[30,30],[740,30],[30,1040],[740,1040]];
  ctx.fillStyle = postcard.front.color;
  corners.forEach(([x,y]) => {
    ctx.fillRect(x-4, y-4, 8, 8);
  });

  return new THREE.CanvasTexture(c);
}

// Generate back texture
function createBackTexture(postcard) {
  const c = document.createElement('canvas');
  c.width = 800;
  c.height = 1100;
  const ctx = c.getContext('2d');

  // Dark background
  ctx.fillStyle = '#1A1210';
  ctx.fillRect(0, 0, 800, 1100);

  // Subtle grid
  ctx.strokeStyle = '#2A1A1240';
  ctx.lineWidth = 0.5;
  for (let i = 0; i < 800; i += 20) {
    ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 1100); ctx.stroke();
  }
  for (let i = 0; i < 1100; i += 20) {
    ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(800, i); ctx.stroke();
  }

  // Header — robot ID
  ctx.fillStyle = '#E8763A';
  ctx.font = 'bold 28px "Archivo Black", sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText(postcard.name, 60, 80);

  // Separator line
  ctx.strokeStyle = '#E8763A40';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(60, 100);
  ctx.lineTo(740, 100);
  ctx.stroke();

  // Data fields
  ctx.fillStyle = '#8B8B8B';
  ctx.font = '14px "Space Mono", monospace';
  ctx.fillText(`SOL ${postcard.sol}`, 60, 135);
  ctx.fillText(`COORDS: ${postcard.coords}`, 60, 160);
  ctx.fillText(`SIGNAL: ${'█'.repeat(Math.floor(postcard.signal/10))}${'░'.repeat(10-Math.floor(postcard.signal/10))} ${postcard.signal}%`, 60, 185);
  ctx.fillText(`RELAY: RELAY-1 → EARTH`, 60, 210);

  // Separator
  ctx.strokeStyle = '#D4A57430';
  ctx.beginPath();
  ctx.moveTo(60, 240);
  ctx.lineTo(740, 240);
  ctx.stroke();

  // Message
  ctx.fillStyle = '#F5EDE3';
  ctx.font = '22px "DM Sans", sans-serif';
  const lines = postcard.back.message.split('\n');
  lines.forEach((line, i) => {
    ctx.fillText(line, 60, 300 + i * 36);
  });

  // Signature line
  const msgBottom = 300 + lines.length * 36 + 30;
  ctx.strokeStyle = '#D4A57430';
  ctx.beginPath();
  ctx.moveTo(60, msgBottom);
  ctx.lineTo(740, msgBottom);
  ctx.stroke();

  ctx.fillStyle = '#D4A574';
  ctx.font = '14px "Space Mono", monospace';
  ctx.fillText(`— ${postcard.name}`, 60, msgBottom + 30);

  // Bottom data decoration
  ctx.fillStyle = '#8B8B8B30';
  ctx.font = '10px "Space Mono", monospace';
  for (let row = 0; row < 4; row++) {
    let dataLine = '';
    for (let col = 0; col < 8; col++) {
      dataLine += Math.floor(Math.random() * 256).toString(2).padStart(8, '0') + '  ';
    }
    ctx.fillText(dataLine, 60, 980 + row * 18);
  }

  // Border
  ctx.strokeStyle = '#D4A57430';
  ctx.lineWidth = 2;
  ctx.strokeRect(30, 30, 740, 1040);

  return new THREE.CanvasTexture(c);
}

// ─── Create card mesh ───
let frontMat, backMat, cardMesh;

function buildCard(index) {
  const pc = postcards[index];

  // Remove old card
  while (cardGroup.children.length) cardGroup.remove(cardGroup.children[0]);

  const frontTex = createFrontTexture(pc);
  const backTex = createBackTexture(pc);

  frontTex.colorSpace = THREE.SRGBColorSpace;
  backTex.colorSpace = THREE.SRGBColorSpace;

  frontMat = new THREE.MeshPhysicalMaterial({
    map: frontTex,
    metalness: 0.4,
    roughness: 0.25,
    clearcoat: 1.0,
    clearcoatRoughness: 0.1,
    reflectivity: 0.8,
    side: THREE.FrontSide,
  });

  backMat = new THREE.MeshPhysicalMaterial({
    map: backTex,
    metalness: 0.3,
    roughness: 0.3,
    clearcoat: 0.8,
    clearcoatRoughness: 0.15,
    reflectivity: 0.6,
    side: THREE.FrontSide,
  });

  // Front face
  const frontGeo = new THREE.PlaneGeometry(CARD_W, CARD_H);
  const frontMesh = new THREE.Mesh(frontGeo, frontMat);
  frontMesh.name = 'front';

  // Back face (flipped)
  const backGeo = new THREE.PlaneGeometry(CARD_W, CARD_H);
  const backMesh = new THREE.Mesh(backGeo, backMat);
  backMesh.rotation.y = Math.PI;
  backMesh.name = 'back';

  // Card edge (thin box)
  const edgeGeo = new THREE.BoxGeometry(CARD_W, CARD_H, 0.01);
  const edgeMat = new THREE.MeshPhysicalMaterial({
    color: 0xD4A574,
    metalness: 0.6,
    roughness: 0.3,
    clearcoat: 1.0,
  });
  const edgeMesh = new THREE.Mesh(edgeGeo, edgeMat);
  edgeMesh.name = 'edge';

  frontMesh.position.z = 0.006;
  backMesh.position.z = -0.006;

  cardGroup.add(edgeMesh);
  cardGroup.add(frontMesh);
  cardGroup.add(backMesh);

  // Update UI
  document.getElementById('robotId').textContent = pc.name;
  document.getElementById('signal').innerHTML =
    `SIGNAL: ${'█'.repeat(Math.floor(pc.signal/10))}${'░'.repeat(10-Math.floor(pc.signal/10))} ${pc.signal}%<br>` +
    `RELAY-1 → EARTH<br>` +
    `SOL ${pc.sol} · ${pc.coords}`;
}

buildCard(0);

// ─── Mouse / touch interaction ───
let mouseX = 0, mouseY = 0;
let isDragging = false;

function onPointerMove(e) {
  const x = e.clientX ?? e.touches?.[0]?.clientX ?? 0;
  const y = e.clientY ?? e.touches?.[0]?.clientY ?? 0;
  mouseX = (x / window.innerWidth) * 2 - 1;
  mouseY = (y / window.innerHeight) * 2 - 1;
}

window.addEventListener('pointermove', onPointerMove);

// Click to flip
canvas.addEventListener('click', () => {
  isFlipped = !isFlipped;
  targetFlip = isFlipped ? Math.PI : 0;
  document.getElementById('hint').textContent = isFlipped ? 'click to flip back' : 'click to flip · drag to tilt';
});

// Nav
document.getElementById('prevBtn').addEventListener('click', (e) => {
  e.stopPropagation();
  currentIndex = (currentIndex - 1 + postcards.length) % postcards.length;
  isFlipped = false;
  targetFlip = 0;
  flipAngle = 0;
  buildCard(currentIndex);
});

document.getElementById('nextBtn').addEventListener('click', (e) => {
  e.stopPropagation();
  currentIndex = (currentIndex + 1) % postcards.length;
  isFlipped = false;
  targetFlip = 0;
  flipAngle = 0;
  buildCard(currentIndex);
});

// ─── Dust particles (CSS) ───
function spawnDust() {
  const el = document.createElement('div');
  el.className = 'dust';
  el.style.left = Math.random() * 100 + 'vw';
  el.style.top = Math.random() * 100 + 'vh';
  el.style.setProperty('--dx', (Math.random() - 0.5) * 200 + 'px');
  el.style.setProperty('--dy', (Math.random() - 0.5) * 200 + 'px');
  const dur = 4 + Math.random() * 8;
  el.style.animationDuration = dur + 's';
  el.style.width = (1 + Math.random() * 2) + 'px';
  el.style.height = el.style.width;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), dur * 1000);
}
setInterval(spawnDust, 300);
for (let i = 0; i < 15; i++) setTimeout(spawnDust, i * 200);

// ─── Resize ───
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// ─── Animate ───
function animate() {
  requestAnimationFrame(animate);

  // Smooth tilt
  const tiltStrength = 0.15;
  targetRotY = mouseX * tiltStrength;
  targetRotX = -mouseY * tiltStrength;

  currentRotX += (targetRotX - currentRotX) * 0.08;
  currentRotY += (targetRotY - currentRotY) * 0.08;

  // Smooth flip
  flipAngle += (targetFlip - flipAngle) * 0.08;

  cardGroup.rotation.x = currentRotX;
  cardGroup.rotation.y = currentRotY + flipAngle;

  // Subtle float
  cardGroup.position.y = Math.sin(Date.now() * 0.001) * 0.03;

  // Light follows mouse slightly
  keyLight.position.x = 3 + mouseX * 2;
  keyLight.position.y = 4 + mouseY * 1;

  renderer.render(scene, camera);
}

animate();

// ─── Keyboard nav ───
window.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') document.getElementById('prevBtn').click();
  if (e.key === 'ArrowRight') document.getElementById('nextBtn').click();
  if (e.key === ' ') { e.preventDefault(); canvas.click(); }
});
</script>

</body>
</html>
